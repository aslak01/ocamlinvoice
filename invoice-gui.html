<!DOCTYPE html>
<html>
<head>
    <title>Invoice Generator Configuration</title>
    <meta charset="UTF-8">
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; 
            margin: 0;
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            padding: 40px; 
            border-radius: 12px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.2); 
        }
        h1 { 
            color: #2c3e50; 
            text-align: center;
            margin-bottom: 30px;
            font-weight: 300;
            font-size: 2.5em;
            border-bottom: 3px solid #3498db; 
            padding-bottom: 15px; 
        }
        .tabs { 
            display: flex; 
            gap: 5px; 
            margin-bottom: 20px; 
            border-bottom: 2px solid #ecf0f1; 
            padding-bottom: 0;
        }
        .tab { 
            padding: 12px 24px; 
            background: #ecf0f1; 
            border: none; 
            cursor: pointer; 
            border-radius: 8px 8px 0 0; 
            transition: all 0.3s ease; 
            font-weight: 500;
            font-size: 14px;
        }
        .tab:hover { 
            background: #d5dbdb; 
            transform: translateY(-2px);
        }
        .tab.active { 
            background: #3498db; 
            color: white; 
            box-shadow: 0 4px 8px rgba(52,152,219,0.3);
        }
        .editor-section {
            margin-bottom: 20px;
        }
        #file-label {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.2em;
            font-weight: 500;
        }
        textarea { 
            width: 100%; 
            height: 450px; 
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', 'Consolas', monospace; 
            font-size: 14px; 
            border: 2px solid #bdc3c7; 
            border-radius: 8px; 
            padding: 20px; 
            resize: vertical; 
            box-sizing: border-box;
            transition: border-color 0.3s ease;
            line-height: 1.5;
        }
        textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.1);
        }
        .dual-input {
            display: none;
        }
        .dual-input.active {
            display: block;
        }
        .dual-input textarea {
            height: 200px;
            margin-bottom: 15px;
        }
        .dual-input label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
        }
        .single-input {
            display: block;
        }
        .single-input.hidden {
            display: none;
        }
        .controls { 
            margin-top: 30px; 
            display: flex; 
            gap: 15px; 
            align-items: center; 
            justify-content: center;
            flex-wrap: wrap;
        }
        button { 
            padding: 12px 24px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: 500;
            transition: all 0.3s ease; 
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .save-btn { 
            background: #27ae60; 
            color: white; 
        }
        .save-btn:hover { 
            background: #229954; 
        }
        .generate-btn { 
            background: #3498db; 
            color: white; 
        }
        .generate-btn:hover { 
            background: #2980b9; 
        }
        .dry-run-btn { 
            background: #f39c12; 
            color: white; 
        }
        .dry-run-btn:hover { 
            background: #e67e22; 
        }
        .status { 
            padding: 15px; 
            margin-top: 20px; 
            border-radius: 6px; 
            text-align: center;
            font-weight: 500;
        }
        .success { 
            background: #d5f4e6; 
            border: 2px solid #27ae60; 
            color: #1e8449; 
        }
        .error { 
            background: #fadbd8; 
            border: 2px solid #e74c3c; 
            color: #c0392b; 
        }
        .info {
            background: #d6eaf8;
            border: 2px solid #3498db;
            color: #2874a6;
        }
        .warning {
            background: #fff3cd;
            border: 2px solid #f39c12;
            color: #b7700a;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Invoice Generator</h1>
        
        <div class="warning">
            <strong>Note:</strong> This is a local HTML file interface. Use the buttons below to interact with the files.
        </div>
        
        <div class="tabs">        <button class="tab" onclick="switchTab('sender.txt', 'Sender Information')">Sender Information</button>
        <button class="tab" onclick="switchTab('bankdetails.txt', 'Bank Details')">Bank Details</button>
        <button class="tab" onclick="switchTab('invoice_details', 'Invoice Details')">Invoice Details</button>
        <button class="tab" onclick="switchTab('recipients.txt', 'Recipients')">Recipients</button>        </div>
        
        <div class="editor-section">
            <h3 id="file-label">Loading...</h3>
            
            <!-- Single file editor -->
            <div id="single-input" class="single-input">
                <textarea id="editor" placeholder="File content will appear here..."></textarea>
            </div>
            
            <!-- Dual file editor for invoice details -->
            <div id="dual-input" class="dual-input">
                <label for="description-editor">Description:</label>
                <textarea id="description-editor" placeholder="Enter invoice description here..."></textarea>
                
                <label for="amount-editor">Amount (NOK):</label>
                <textarea id="amount-editor" placeholder="Enter amount here (e.g., 3750.50)"></textarea>
            </div>
            
            <input type="hidden" id="current-file">
        </div>
        
        <div class="controls">
            <button class="save-btn" onclick="saveCurrentFile()">Save Current File</button>
            <button class="generate-btn" onclick="generateInvoices(false)">Generate Invoices</button>
            <button class="dry-run-btn" onclick="generateInvoices(true)">Preview Mode</button>
        </div>
        
        <div id="status"></div>
    </div>

    <script>
        // File data embedded from OCaml
        const fileData = {    'sender.txt': { label: 'Sender Information', content: 'Firmaet Mitt AS\n123123123123\nGatevei 123\n1324 Bosted\n\nMerk overføringen \"abc123\"\n\n' },
    'bankdetails.txt': { label: 'Bank Details', content: 'Kontonummer: 1231 12 1231\nKID: 987987987987987\n\n' },
    'invoice_details': { label: 'Invoice Details', content: 'Software development consulting services, Web application development and maintenance', amount: '3750.50' },
    'recipients.txt': { label: 'Recipients', content: 'John Smith\njohn.smith@email.com\n123 Main Street\nAnytown, State 12345\n\nJane Johnson\njane.johnson@company.com\n456 Oak Avenue\nBusiness District\nCity, State 67890\n\nBob Wilson\nbob.wilson@example.org\n789 Pine Road\nSuburb\nAnother City, State 54321' }        };
        
        let currentFile = '';
        
        function switchTab(filename, label) {
            // Save current file before switching
            if (currentFile && currentFile !== filename) {
                saveCurrentFile();
            }
            
            // Update UI
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            // Load file content
            const data = fileData[filename];
            if (data) {
                document.getElementById('file-label').textContent = data.label;
                document.getElementById('current-file').value = filename;
                currentFile = filename;
                
                // Check if this is the invoice details tab (has amount field)
                if (data.amount !== undefined) {
                    // Show dual input layout
                    document.getElementById('single-input').classList.add('hidden');
                    document.getElementById('dual-input').classList.add('active');
                    
                    document.getElementById('description-editor').value = data.content.replace(/\\\\n/g, '\n');
                    document.getElementById('amount-editor').value = data.amount.replace(/\\\\n/g, '\n');
                } else {
                    // Show single input layout
                    document.getElementById('dual-input').classList.remove('active');
                    document.getElementById('single-input').classList.remove('hidden');
                    
                    document.getElementById('editor').value = data.content.replace(/\\\\n/g, '\n');
                }
            }
        }
        
        function saveCurrentFile() {
            const filename = document.getElementById('current-file').value;
            
            if (!filename) return;
            
            // Update local data based on current layout
            if (fileData[filename]) {
                if (fileData[filename].amount !== undefined) {
                    // Dual input mode
                    const description = document.getElementById('description-editor').value;
                    const amount = document.getElementById('amount-editor').value;
                    fileData[filename].content = description.replace(/\n/g, '\\\\n');
                    fileData[filename].amount = amount.replace(/\n/g, '\\\\n');
                } else {
                    // Single input mode
                    const content = document.getElementById('editor').value;
                    fileData[filename].content = content.replace(/\n/g, '\\\\n');
                }
            }
            
            showStatus('File content updated locally. Use Generate buttons to save to disk.', 'info');
        }
        
        function generateInvoices(dryRun) {
            saveCurrentFile();
            const mode = dryRun ? 'preview' : 'normal';
            showStatus('Processing files and generating invoices in ' + mode + ' mode...', 'info');
            
            setTimeout(() => {
                showStatus(
                    'Files updated! Please run the command line tool to generate invoices:<br>' +
                    '• Normal mode: dune exec src/main.exe<br>' +
                    '• Preview mode: dune exec src/main.exe -- -dry',
                    'success'
                );
            }, 1000);
        }
        
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.innerHTML = '<div class="status ' + type + '">' + message + '</div>';
            setTimeout(() => {
                if (type !== 'success') status.innerHTML = '';
            }, type === 'info' ? 3000 : 8000);
        }
        
        // Initialize first tab
        window.onload = function() {
            const firstTab = document.querySelector('.tab');
            if (firstTab) {
                firstTab.click();
            }
        };
        
        // Auto-save on tab switch and before unload
        window.addEventListener('beforeunload', saveCurrentFile);
    </script>
</body>
</html>